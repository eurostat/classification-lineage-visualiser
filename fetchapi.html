<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SPARQL Fetch</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  
</head>
<body>
  <h1>SPARQL Fetch</h1>
  <label for="endpoint-url">Endpoint URL:</label>
  <input type="text" id="endpoint-url" name="endpoint-url" placeholder="http://publications.europa.eu/webapi/rdf/sparql"
    style="margin-bottom: 20px; width: 100%; padding: 5px; font-size: 1.1em;">
  <h2>Select PREFIXES:</h2>
  <div id="prefixes">
    <input type="checkbox" id="prefix0" > <label for="prefix0">PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</label><br>
    <input type="checkbox" id="prefix1" checked> <label for="prefix1">PREFIX : &lt;http://data.europa.eu/xsp/cn2022/&gt;</label><br>
    <input type="checkbox" id="prefix2" > <label for="prefix2">PREFIX nace: &lt;http://data.europa.eu/ux2/nace2/&gt;</label><br>
    <input type="checkbox" id="prefix3" > <label for="prefix3">PREFIX fn: &lt;http://www.w3.org/2005/xpath-functions#&gt;</label><br>
    <input type="checkbox" id="prefix4" > <label for="prefix4">PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;</label><br>
    <input type="checkbox" id="prefix5" > <label for="prefix5">PREFIX gn: &lt;http://www.geonames.org/ontology#&gt;</label><br>
    <input type="checkbox" id="prefix6" > <label for="prefix6">PREFIX grddl: &lt;http://www.w3.org/2003/g/data-view#&gt;</label><br>
    <input type="checkbox" id="prefix7" > <label for="prefix7">PREFIX lemon: &lt;http://lemon-model.net/lemon#&gt;</label><br>
    <input type="checkbox" id="prefix8" > <label for="prefix8">PREFIX lexinfo: &lt;http://www.lexinfo.net/ontology/2.0/lexinfo#&gt;</label><br>
    <input type="checkbox" id="prefix9" > <label for="prefix9">PREFIX lexvo: &lt;http://lexvo.org/ontology#&gt;</label><br>
    <input type="checkbox" id="prefix10" > <label for="prefix10">PREFIX locn: &lt;https://www.w3.org/ns/locn#&gt;</label><br>
    <input type="checkbox" id="prefix11" > <label for="prefix11">PREFIX luc: &lt;http://www.ontotext.com/owlim/lucene#&gt;</label><br>
    <input type="checkbox" id="prefix12" > <label for="prefix12">PREFIX oa: &lt;http://www.w3.org/ns/oa#&gt;</label><br>
    <input type="checkbox" id="prefix13" > <label for="prefix13">PREFIX org: &lt;http://www.w3.org/ns/org#&gt;</label><br>
    <input type="checkbox" id="prefix14" > <label for="prefix14">PREFIX owl: &lt;http://www.w3.org/2002/07/owl#&gt;</label><br>
    <input type="checkbox" id="prefix15" > <label for="prefix15">PREFIX qb: &lt;http://purl.org/linked-data/cube#&gt;</label><br>
    <input type="checkbox" id="prefix16" > <label for="prefix16">PREFIX rdf4j: &lt;http://rdf4j.org/schema/rdf4j#&gt;</label><br>
    <input type="checkbox" id="prefix17" > <label for="prefix17">PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</label><br>
    <input type="checkbox" id="prefix18" > <label for="prefix18">PREFIX schema: &lt;http://schema.org/&gt;</label><br>
    <input type="checkbox" id="prefix19" > <label for="prefix19">PREFIX sesame: &lt;http://www.openrdf.org/schema/sesame#&gt;</label><br>
    <input type="checkbox" id="prefix20" checked> <label for="prefix20">PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;</label><br>
    <input type="checkbox" id="prefix21" checked> <label for="prefix21">PREFIX xkos: &lt;http://rdf-vocabulary.ddialliance.org/xkos#&gt;</label><br>
  </div>
  <textarea id="sparql-query" rows="25" style="width: 100%;" placeholder="Enter SPARQL query"></textarea>
  <button id="execute-query">Execute</button>
  <pre id="results"></pre>
  <script>
    let checkedPrefixes = '';
    for (let i = 0; i <= 21; i++) {
      const checkbox = document.getElementById('prefix' + i);
      if (checkbox.checked) {
        const label = document.querySelector(`label[for="prefix${i}"]`);
        checkedPrefixes += label.textContent + '\n';
      }
    }
    const testQuery = `
    SELECT (?S_KEY as ?CN2022_KEY) (?S_CODE as ?CN2022_CODE) (?NAME_Source as ?CN2022_NAME) (?T_KEY as ?CN2021_KEY) (?T_CODE as ?CN2021_CODE) (?NAME_Target as ?CN2021_NAME) 
    WHERE {
      :CN2022_CN2021 xkos:madeOf ?Associations .
      ?Associations xkos:sourceConcept ?Source .

      ?Source skos:notation ?S_Notation;
        skos:altLabel ?S_Name;
        qb:identifier ?S_KEY .
      BIND (STR(?S_Notation) as ?S_CODE)
      BIND (STR(?S_Name) AS ?NAME_Source)
      FILTER (LANG(?S_Name) = "en")
          FILTER (regex(?S_KEY, "8479200000*"))

      OPTIONAL { ?Associations rdfs:comment ?Comment . }

      OPTIONAL { ?Associations xkos:targetConcept ?Target .
           ?Target skos:notation ?T_Notation ;
             skos:altLabel ?T_Name;
             qb:identifier ?T_KEY .}
      FILTER (LANG(?T_Name) = "en")
      BIND (STR(?T_Name) AS ?NAME_Target)
      BIND (STR(?T_Notation) as ?T_CODE )
    } LIMIT 100
    `;

    const sparqlQueryInput = document.getElementById('sparql-query');
    const executeButton = document.getElementById('execute-query');
    const resultsPre = document.getElementById('results');
    const endpointInput = document.getElementById('endpoint-url');

    function updateQuery(query) {
      const checkedPrefixes = Array.from(document.querySelectorAll('#prefixes input[type="checkbox"]:checked'))
        .map(checkbox => document.querySelector(`label[for="${checkbox.id}"]`).textContent)
        .join('\n');
      sparqlQueryInput.value = `${checkedPrefixes}\n${query}`;
    }

    for (let i = 0; i <= 21; i++) {
      document.getElementById(`prefix${i}`).addEventListener('change', () => updateQuery(testQuery));
    }

    updateQuery(testQuery);

    function executeQuery() {
      let query = sparqlQueryInput.value.trim();
      if (!query) {
        query = testQuery;
      }

      const sparqlEndpoint = endpointInput.value || endpointInput.placeholder;

      const encodedQuery = encodeURIComponent(query);
      const corsAnywhereUrl = 'https://cors-anywhere.herokuapp.com/';
      $.ajax({
        url: `${corsAnywhereUrl}${sparqlEndpoint}?query=${encodedQuery}`,
        method: 'GET',
        headers: {
          'Accept': 'application/sparql-results+json'
        },
        success: function(data) {
          resultsPre.textContent = JSON.stringify(data, null, 2);
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.error('Error executing query:', errorThrown);
          resultsPre.textContent = 'Error: ' + errorThrown + '\n' + sparqlEndpoint;
        }
      });
    }

    executeButton.addEventListener('click', executeQuery);

    for (let i = 0; i <= 21; i++) {
      document.getElementById(`prefix${i}`).addEventListener('change', () => {
        updateQuery(testQuery);
        executeQuery();
      });
    }
  </script>
</body>
</html>
